<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Benchmark - Token Throughput per GPU vs E2E Latency</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: #1a1a1a;
        }
        .subtitle {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: #333;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            background: #fff;
            cursor: pointer;
            min-width: 200px;
        }
        select:hover {
            border-color: #999;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 500px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 10px;
        }
        .legend-container {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: #333;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }
        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #555;
        }
        .info-box h3 {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: #333;
        }
        .info-box ul {
            margin-left: 20px;
        }
        .info-box li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
    <h1>Token Throughput per GPU vs End-to-end Latency</h1>
    <p class="subtitle">vLLM Benchmark • 8 GPUs • C100 P100 O128</p>
    
    <div class="controls">
        <div class="control-group">
            <label for="gpuSelect">GPU Type</label>
            <select id="gpuSelect">
                <option value="all">All GPUs</option>
                <option value="b200">B200 (RunPod)</option>
                <option value="h200">H200 SXM (RunPod)</option>
                <option value="h100">H100 SXM (RunPod)</option>
            </select>
        </div>
        <div class="control-group">
            <label for="modelSelect">Model</label>
            <select id="modelSelect">
                <option value="all">All Models</option>
                <option value="gpt-oss-120b">GPT-OSS-120B</option>
                <option value="qwen3-32b">Qwen3-32B</option>
            </select>
        </div>
        <div class="control-group">
            <label for="configSelect">Parallelism (TP/DP)</label>
            <select id="configSelect">
                <option value="all">All Configs</option>
                <option value="TP4/DP2">TP4 / DP2</option>
                <option value="TP8/DP1">TP8 / DP1</option>
            </select>
        </div>
    </div>
    
    <div class="chart-container">
        <canvas id="benchmarkChart"></canvas>
    </div>
    
    <div class="legend-container" id="legendContainer"></div>
    
    <div class="info-box">
        <h3>Benchmark Configuration</h3>
        <ul>
            <li><strong>Parallelism:</strong> TP4/DP2 or TP8/DP1 (Total: 8 GPUs)</li>
            <li><strong>Concurrency:</strong> 100 requests</li>
            <li><strong>Input Length:</strong> Variable (1024, 2048, 4096, 8192, 15000 tokens)</li>
            <li><strong>Output Length:</strong> 128 tokens</li>
            <li><strong>Throughput per GPU:</strong> Total Token Throughput / 8</li>
        </ul>
    </div>

    <script>
        // Benchmark data - pre-computed Token Throughput per GPU
        // Formula: Total Token Throughput / 8 GPUs
        const benchmarkData = {
            // ========== TP4/DP2 Data ==========
            // H100 SXM (RunPod) - GPT-OSS-120B - TP4/DP2
            'h100_gpt-oss-120b_TP4/DP2': [
                { ctx: 1024, throughputPerGpu: 4022, e2eLatency: 3.54, config: 'TP4/DP2' },
                { ctx: 2048, throughputPerGpu: 7149, e2eLatency: 3.74, config: 'TP4/DP2' },
                { ctx: 4096, throughputPerGpu: 9840, e2eLatency: 5.25, config: 'TP4/DP2' },
                { ctx: 8192, throughputPerGpu: 12300, e2eLatency: 8.24, config: 'TP4/DP2' },
                { ctx: 15000, throughputPerGpu: 14135, e2eLatency: 13.01, config: 'TP4/DP2' }
            ],
            // H100 SXM (RunPod) - Qwen3-32B - TP4/DP2
            'h100_qwen3-32b_TP4/DP2': [
                { ctx: 1024, throughputPerGpu: 3760, e2eLatency: 3.52, config: 'TP4/DP2' },
                { ctx: 2048, throughputPerGpu: 6364, e2eLatency: 4.20, config: 'TP4/DP2' },
                { ctx: 4096, throughputPerGpu: 7729, e2eLatency: 6.71, config: 'TP4/DP2' },
                { ctx: 8192, throughputPerGpu: 7693, e2eLatency: 13.15, config: 'TP4/DP2' },
                { ctx: 15000, throughputPerGpu: 7684, e2eLatency: 24.06, config: 'TP4/DP2' }
            ],
            // H200 SXM (RunPod) - GPT-OSS-120B - TP4/DP2
            'h200_gpt-oss-120b_TP4/DP2': [
                { ctx: 1024, throughputPerGpu: 4330, e2eLatency: 3.29, config: 'TP4/DP2' },
                { ctx: 2048, throughputPerGpu: 7740, e2eLatency: 3.46, config: 'TP4/DP2' },
                { ctx: 4096, throughputPerGpu: 11235, e2eLatency: 4.60, config: 'TP4/DP2' },
                { ctx: 8192, throughputPerGpu: 13115, e2eLatency: 7.71, config: 'TP4/DP2' },
                { ctx: 15000, throughputPerGpu: 14365, e2eLatency: 12.78, config: 'TP4/DP2' }
            ],
            // H200 SXM (RunPod) - Qwen3-32B - TP4/DP2
            'h200_qwen3-32b_TP4/DP2': [
                { ctx: 1024, throughputPerGpu: 4687, e2eLatency: 3.02, config: 'TP4/DP2' },
                { ctx: 2048, throughputPerGpu: 6637, e2eLatency: 4.05, config: 'TP4/DP2' },
                { ctx: 4096, throughputPerGpu: 8821, e2eLatency: 5.88, config: 'TP4/DP2' },
                { ctx: 8192, throughputPerGpu: 8175, e2eLatency: 12.38, config: 'TP4/DP2' },
                { ctx: 15000, throughputPerGpu: 8092, e2eLatency: 22.54, config: 'TP4/DP2' }
            ],
            
            // ========== TP8/DP1 Data ==========
            // H100 SXM (RunPod) - GPT-OSS-120B - TP8/DP1
            'h100_gpt-oss-120b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 3809, e2eLatency: 3.70, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 8344, e2eLatency: 3.18, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 11653, e2eLatency: 4.39, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 14554, e2eLatency: 6.87, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 17243, e2eLatency: 10.47, config: 'TP8/DP1' }
            ],
            // H100 SXM (RunPod) - Qwen3-32B - TP8/DP1
            'h100_qwen3-32b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 4174, e2eLatency: 3.40, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 7522, e2eLatency: 3.56, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 8628, e2eLatency: 6.00, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 9013, e2eLatency: 11.27, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 9218, e2eLatency: 19.95, config: 'TP8/DP1' }
            ],
            // H200 SXM (RunPod) - GPT-OSS-120B - TP8/DP1
            'h200_gpt-oss-120b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 4114, e2eLatency: 3.43, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 8981, e2eLatency: 2.95, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 12553, e2eLatency: 4.07, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 15755, e2eLatency: 6.33, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 18640, e2eLatency: 9.69, config: 'TP8/DP1' }
            ],
            // H200 SXM (RunPod) - Qwen3-32B - TP8/DP1
            'h200_qwen3-32b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 4408, e2eLatency: 3.22, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 8086, e2eLatency: 3.31, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 9186, e2eLatency: 5.64, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 9445, e2eLatency: 10.78, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 9518, e2eLatency: 19.38, config: 'TP8/DP1' }
            ],
            
            // ========== B200 Data ==========
            // B200 (RunPod) - GPT-OSS-120B - TP8/DP1
            'b200_gpt-oss-120b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 5135, e2eLatency: 2.75, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 9969, e2eLatency: 2.66, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 14326, e2eLatency: 3.56, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 18261, e2eLatency: 5.46, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 22036, e2eLatency: 8.19, config: 'TP8/DP1' }
            ],
            // B200 (RunPod) - Qwen3-32B - TP4/DP2
            'b200_qwen3-32b_TP4/DP2': [
                { ctx: 1024, throughputPerGpu: 5839, e2eLatency: 2.26, config: 'TP4/DP2' },
                { ctx: 2048, throughputPerGpu: 9848, e2eLatency: 2.72, config: 'TP4/DP2' },
                { ctx: 4096, throughputPerGpu: 13957, e2eLatency: 3.71, config: 'TP4/DP2' },
                { ctx: 8192, throughputPerGpu: 15544, e2eLatency: 6.51, config: 'TP4/DP2' },
                { ctx: 15000, throughputPerGpu: 14878, e2eLatency: 12.39, config: 'TP4/DP2' }
            ],
            // B200 (RunPod) - Qwen3-32B - TP8/DP1
            'b200_qwen3-32b_TP8/DP1': [
                { ctx: 1024, throughputPerGpu: 6039, e2eLatency: 2.34, config: 'TP8/DP1' },
                { ctx: 2048, throughputPerGpu: 10977, e2eLatency: 2.43, config: 'TP8/DP1' },
                { ctx: 4096, throughputPerGpu: 13230, e2eLatency: 3.89, config: 'TP8/DP1' },
                { ctx: 8192, throughputPerGpu: 14755, e2eLatency: 6.84, config: 'TP8/DP1' },
                { ctx: 15000, throughputPerGpu: 15830, e2eLatency: 11.54, config: 'TP8/DP1' }
            ]
        };

        // Color scheme: GPU_Model_Config
        const colors = {
            // TP4/DP2 - solid colors
            'h100_gpt-oss-120b_TP4/DP2': '#2563eb',
            'h100_qwen3-32b_TP4/DP2': '#16a34a',
            'h200_gpt-oss-120b_TP4/DP2': '#dc2626',
            'h200_qwen3-32b_TP4/DP2': '#9333ea',
            'b200_qwen3-32b_TP4/DP2': '#ea580c',
            // TP8/DP1 - lighter/different shades
            'h100_gpt-oss-120b_TP8/DP1': '#60a5fa',
            'h100_qwen3-32b_TP8/DP1': '#4ade80',
            'h200_gpt-oss-120b_TP8/DP1': '#f87171',
            'h200_qwen3-32b_TP8/DP1': '#c084fc',
            'b200_gpt-oss-120b_TP8/DP1': '#f97316',
            'b200_qwen3-32b_TP8/DP1': '#fb923c'
        };

        const labels = {
            'h100_gpt-oss-120b_TP4/DP2': 'H100 GPT-OSS-120B (TP4/DP2)',
            'h100_qwen3-32b_TP4/DP2': 'H100 Qwen3-32B (TP4/DP2)',
            'h200_gpt-oss-120b_TP4/DP2': 'H200 GPT-OSS-120B (TP4/DP2)',
            'h200_qwen3-32b_TP4/DP2': 'H200 Qwen3-32B (TP4/DP2)',
            'b200_qwen3-32b_TP4/DP2': 'B200 Qwen3-32B (TP4/DP2)',
            'h100_gpt-oss-120b_TP8/DP1': 'H100 GPT-OSS-120B (TP8/DP1)',
            'h100_qwen3-32b_TP8/DP1': 'H100 Qwen3-32B (TP8/DP1)',
            'h200_gpt-oss-120b_TP8/DP1': 'H200 GPT-OSS-120B (TP8/DP1)',
            'h200_qwen3-32b_TP8/DP1': 'H200 Qwen3-32B (TP8/DP1)',
            'b200_gpt-oss-120b_TP8/DP1': 'B200 GPT-OSS-120B (TP8/DP1)',
            'b200_qwen3-32b_TP8/DP1': 'B200 Qwen3-32B (TP8/DP1)'
        };

        let chart;

        function getFilteredData(gpuFilter, modelFilter, configFilter) {
            const datasets = [];
            
            Object.keys(benchmarkData).forEach(key => {
                const parts = key.split('_');
                const gpu = parts[0];
                const model = parts[1];
                const config = parts[2];
                
                // Apply filters
                if (gpuFilter !== 'all' && gpu !== gpuFilter) return;
                if (modelFilter !== 'all' && model !== modelFilter) return;
                if (configFilter !== 'all' && config !== configFilter) return;
                
                const data = benchmarkData[key].map(d => ({
                    x: d.e2eLatency,
                    y: d.throughputPerGpu,
                    ctx: d.ctx,
                    config: d.config
                }));
                
                // Sort by e2eLatency (x-axis) for proper line connection
                data.sort((a, b) => a.x - b.x);
                
                // Different line style for TP8/DP1
                const isTP8 = config === 'TP8/DP1';
                
                datasets.push({
                    label: labels[key],
                    data: data,
                    backgroundColor: colors[key],
                    borderColor: colors[key],
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    showLine: true,
                    tension: 0,
                    borderWidth: 2,
                    borderDash: isTP8 ? [5, 5] : [] // Dashed line for TP8/DP1
                });
            });
            
            return datasets;
        }

        function updateLegend(datasets) {
            const container = document.getElementById('legendContainer');
            container.innerHTML = datasets.map(ds => `
                <div class="legend-item">
                    <div class="legend-line" style="background: ${ds.borderColor}; ${ds.borderDash.length ? 'background: repeating-linear-gradient(90deg, ' + ds.borderColor + ' 0px, ' + ds.borderColor + ' 5px, transparent 5px, transparent 10px);' : ''}"></div>
                    <span>${ds.label}</span>
                </div>
            `).join('');
        }

        function createChart() {
            const ctx = document.getElementById('benchmarkChart').getContext('2d');
            const datasets = getFilteredData('all', 'all', 'all');
            
            chart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(255,255,255,0.95)',
                            titleColor: '#333',
                            bodyColor: '#666',
                            borderColor: '#ddd',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    return context[0].dataset.label;
                                },
                                label: function(context) {
                                    const point = context.raw;
                                    return [
                                        `Context: ${point.ctx} tokens`,
                                        `Parallelism: ${point.config}`,
                                        `Throughput/GPU: ${point.y.toLocaleString()} tok/s`,
                                        `E2E Latency: ${point.x.toFixed(2)}s`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'End-to-end Latency (s)',
                                font: { weight: '500' }
                            },
                            grid: { color: '#f0f0f0' },
                            min: 0
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Token Throughput per GPU (tok/s/gpu)',
                                font: { weight: '500' }
                            },
                            grid: { color: '#f0f0f0' },
                            min: 0
                        }
                    }
                }
            });
            
            updateLegend(datasets);
        }

        function updateChart() {
            const gpuFilter = document.getElementById('gpuSelect').value;
            const modelFilter = document.getElementById('modelSelect').value;
            const configFilter = document.getElementById('configSelect').value;
            
            const datasets = getFilteredData(gpuFilter, modelFilter, configFilter);
            chart.data.datasets = datasets;
            chart.update();
            updateLegend(datasets);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            createChart();
            
            document.getElementById('gpuSelect').addEventListener('change', updateChart);
            document.getElementById('modelSelect').addEventListener('change', updateChart);
            document.getElementById('configSelect').addEventListener('change', updateChart);
        });
    </script>
</body>
</html>
